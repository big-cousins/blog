---
layout: post
title: linux open flag
categories: Blog
keywords: 文件系统 open
---

文件的open属性，由open()的flags参数指明。flags参数可分为三类：打开方式、访问方式、I/O操作方式

## 打开方式

以下的常量是选用的

| 操作        | 值（8进制） | 说明                                                         |
| ----------- | ----------- | ------------------------------------------------------------ |
| O_CREAT     | 00000100    | 如果指定文件不存在，则创建这个文件                           |
| O_EXCL      | 00000200    | 如果要创建的文件已存在，则出错                               |
| O_NOCTTY    | 00000400    | 如果欲打开的文件为终端机设备时, 则不会将该终端机当成进程控制终端机. |
| O_TRUNC     | 00001000    | 表示截断，如果文件存在，并且以只写、读写方式打开，则将其长度截断为0 |
| O_APPEND    | 00002000    | 表示追加，如果原来文件里面有内容，则这次写入会写在文件的最末尾。 |
| O_NONBLOCK  | 00004000    | 以不阻塞的方式打开文件, 也就是无论有无数据读取或等待, 都会立即返回进程之中。 |
| O_LARGEFILE | 00100000    | 允许打开一个大小超过off_t（但没超过off64_t）表示范围的文件   |
| O_NDELAY    | 00004000    | 与 O_NONBLOCK一样，#define O_NONBLOCK   O_NDELAY             |

open 已存在并有内容的文件时：O_TRUNC、O_APPEND

带O_TRUNC属性去打开文件时，如果这个文件中本来是有内容的，则原来的内容会被丢弃。

带O_APPEND属性去打开文件时，如果这个文件中本来是有内容的，则新写入的内容会接续到原来内容的后面

文件状态标签中的标志可分为三类：访问方式、打开时标志和I/O操作方式

open 不存在的文件时：O_CREAT、O_EXCL

带O_CREAT属性去打开一个并不存在的文件时，去创建并且打开它

O_EXCL标志和O_CREAT标志结合，没有文件时创建文件，有这个文件时会报错提醒我们。



O_NONBLOCK
(1)阻塞与非阻塞。如果一个函数是阻塞式的，调用这个函数时当前进程有可能被卡住（阻塞住，实质是这个函数内部要完成的事情条件不具备，当前没法做，要等待条件成熟）；如果一个函数是非阻塞式的那么我们调用这个函数后一定会立即返回，但是函数有没有完成任务不一定。
(2)阻塞和非阻塞是两种不同的设计思路，并没有好坏。总的来说，阻塞式的结果有保障但是时间没保障；非阻塞式的时间有保障但是结果没保障。
(3)操作系统提供的API和由API封装而成的库函数，有很多本身就是被设计为阻塞式或者非阻塞式的，所以我们应用程度调用这些函数的时候心里得非常清楚。
(4)我们打开一个文件默认就是阻塞式的，如果你希望以非阻塞的方式打开文件，则flag中要加O_NONBLOCK标志。
(2)只用于设备文件，而不用于普通文件。比如说串口、IIC等都是通过文件来访问的，就存在阻塞式和非阻塞式区别。



## 访问方式：

flags参数表示打开文件所采用的操作，我们需要注意的是：必须指定以下三个常量的一种，且只允许指定一个

| 访问方式  | 值（8进制） | 说明     |
| --------- | ----------- | -------- |
| O_RDONLY  | 00000000    | 只读模式 |
| O_WRONLY  | 00000001    | 只写模式 |
| O_RDWR    | 00000002    | 可读可写 |
| O_ACCMODE | 00000003    | 掩码     |

​		

通常来判断访问模式的方法如下

```c
if ((flags & O_ACCMODE) == O_WRONLY)				// 只写
```



## I/O操作方式

direct，sync，async
