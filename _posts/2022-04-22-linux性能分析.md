---
layout: post
title: linux性能分析
date: 2022-04-22
categories: linux
tag: 性能
keywords: linux 性能
---

很多面试官在面试中都会夹杂性能优化问题，通过提问linux的性能问题，可以考察如下三个方面：

- 对linux技术原理的掌握程度：比如CPU的性能调试涉及到中断、软中断、进程调度等；内存的性能调试涉及到伙伴算法、虚拟内存等，通过这些提问可以很快摸清面试者的基础边界。

- 真实项目的实战经验。大部分的程序员在写简历的时候，会把自己的和别人的经验都写上，如果按照简历上写的去提问，如果面试者准备比较充分的话，很可能被蒙蔽，而从一般人不容易留意的性能方面去入手，换一个切面去考察面试者，更容易窥的面试者的真实的技术能力；

- 解决问题/归纳总结的能力。离散的项目经验，不如真实的系统能力，性能问题直接关乎动手能力，也关乎全局的体系能力，知识体系健全的人可以从各个维度看待研发过程碰到的问题，它们的思维更全面，解决问题的能力也更多维。

## 方法论

一个服务出现慢查询下迅速定位问题代码：

1. top查看CPU负载
2. 高的话分析On-CPU，低的话分析Off-CPU
3. 跑cpudist查看是否是Off-CPU的问题
4. 跑bcc-offcputime/Systemtap查找出现问题的堆栈
5. 可以用动态追踪更加细化的分析到底是内核哪里出现问题（磁盘，网络，内存，锁）（Off-CPU过高基本是内核/资源的问题）
6. 如果是On-CPU的话就从日志出发进行排错了。
